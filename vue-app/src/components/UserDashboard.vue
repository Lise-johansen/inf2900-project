<template>
  <div class="user-dashboard">
    
    <div class="flex-container">
      <div class="profilepicture-container">
        <div class="profile-picture-outline">
          <img v-if="profilePicture" :src="profilePicture" alt="Avatar" class="profile-picture">
          <input type="file" accept="image/jpeg,image/png" @change="handleImageUpload" :style="{ display: profilePicture ? 'none' : 'block' }">
        </div>
      </div>
      
      <div class="user-info">
        <p class="Realname">{{ user.firstName + " " + user.lastName}}</p>
        <p>{{ user.email }}</p>
        <p>{{ user.address }}</p>
        <p>{{ user.phone }}</p>
      </div>
    </div>

    <div class=verify-badge>
      <svg v-if="user.verified" class="verified-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <path fill="blue" d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
      </svg>
    </div>

      <div class="divider"></div>

      <div class="button-grid">
        <router-link to="/listings" class="button-link">My listings</router-link>
        <router-link to="/favorites" class="button-link">My favorites</router-link>
        <router-link to="/my-account" class="button-link">My account</router-link>
        <router-link to="/privacy-policy" class="button-link">Privacy policy</router-link>
      </div>
      
      <button class="logout-button" @click="logout">Logout</button>

    </div>
</template>


<script>
  import axios from 'axios';

  export default {
    data() {
        return {
        user: {
            firstName: '',
            lastName: '',
            email: '',
            phone: '',
            address: '',
            profilepicture: '',
            verified: false,
        },
        profilePicture: null
        };
    },

    methods: {
      logout() {
        axios.get('logout/')
        .then(response => {
            this.$router.push('/');
            alert(response.data.message);
          })
      },
      handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => {
            const base64Image = reader.result.split(',')[1]; // Extract base64 data
            const imageData = {
              image: base64Image
            };

            // Upload image data to backend
            axios.put('upload_image/', imageData)
              .then(response => {
                console.log('Image uploaded:', response);
                this.profilePicture = response.data.image_url;
              })
              .catch(error => {
                console.error('Error uploading image:', error);
              });
          };
          reader.readAsDataURL(file); // Start reading the file as a data URL
        }
      },
      getTokenFromCookies() {
        const cookies = document.cookie.split('; ');
        for (const cookie of cookies) {
          const [name, value] = cookie.split('=');
          if (name === 'token') {
            return value;
          }
        }
        return null; // Token not found in cookies
      }
    },

    mounted() {
        // Fetch user data upon component mount
        axios.get('dashboard/')
        .then(response => {
            this.user = response.data;
            this.profilePicture = response.data.profilePicture;
        })
        .catch(error => {
            console.error('Error fetching user data:', error);
        });
    }
  };
</script>


<style scoped>
  .verified-icon {
    width: 24px; /* Adjust size as needed */
    height: 24px; /* Adjust size as needed */
    fill: rgb(0, 197, 219); /* Change color as needed */
    margin-left: 5px; /* Adjust margin as needed */
  }
  
  .user-dashboard {
    max-width: 1200px;
    margin: 0 auto;
  }

  .flex-container {
    display: flex;
    align-items: center;
  }

  p {
    margin-left: 20px;
  }

  .Realname {
    font-family: 'louis_george_cafe', sans-serif;
    font-size: 2em;
    font-weight: bold;
    margin-top: 20px;
    background: linear-gradient(to right, #ff5733, #ffa500, #4169e1);
    -webkit-text-fill-color: transparent;
    -webkit-background-clip: text;
  }

  .profilepicture-container, .profile-picture {
    width: 150px;
    height: 150px;
    margin-top: 20px;
  }
  .profilepicture-container {
    display: flex;
    justify-content: left;
    align-items: center;
  }

  .profile-picture {
    margin-bottom: 20px;
    border-radius: 50%;
    object-fit: cover;
    object-position: center;
    overflow: hidden;
    border: 2px solid #ccc;
    box-sizing: border-box;
  }
  
  .user-info {
    text-align: left;
  }
  .divider {
    height: 3px; /* Adjust the height of the border */
    margin-top: 20px;
    margin-bottom: 2em;
    background: linear-gradient(to left, transparent, #ff5733, #ffa500, #4169e1, transparent);
    opacity: 0.8;
    width: 75em;
  }

  .button-container {
    margin-top: 20px;
  }

  .button-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* Two columns with equal spacing */
    grid-gap: 2em; 
  }

  .button-link, .logout-button {
      display: inline-block;
      justify-content: center;
      padding: 10px 20px;
      font-family: 'louis_george_cafe', sans-serif;
      background-color: #ff5733;
      color: whitesmoke;
      text-decoration: none;
      border: none;
      border-radius: 4px;
      cursor: pointer;
  }

  .button-link:hover, .logout-button:hover {
    background: linear-gradient(to right,#ffa500 0, #ff5733 50%, #ffa500 100%);
  }

  .logout-button {
    font-size: 1em;
    margin-top: 2em;
  }
</style> 